---
title: "05 Parser 语法解析*"
date: 2021-09-24T10:07:21+08:00
draft: false
author: Sunny
weight: 5
---

## 5.1 定义语法规则（Parser Rule）

### 5.1.1 元字符

| 元符号       | 含义        |
| ------------ | ----------- |
| { pat }      | 至少重复0次 |
| [ pat ]      | 至多重复1次 |
| pat1 \| pat2 | 二选一      |
| ( )          | 一个整体    |

### 5.1.2 BNF 语法规则

| 规则                          | 模式1                                  | 模式2             | 模式3 | 模式4 |
| ----------------------------- | -------------------------------------- | ----------------- | ----- | ----- |
| **primary** | "(" **expr** ")"                   | ID                | NUM   | STR   |
| **factor** | "-" **primary**                       | **primary**      |       |       |
| **expr** | **factor** { OP **factor** }       |                   |       |       |
| **block** | "{" [ **state** ] { ( ";" \| EOL ) [ **state** ] } "}" |                   |       |       |
| **simple** | **expr**                           |                   |       |       |
| **state** | "if" **expr** **block** [ "else" **block** ] | "while" **expr** **block** | **simple** |       |
| **program** | [ **state** ] ( ";" \| EOL )        |                   |       |       |

### 5.1.3 元素分类

| 元素     | 类别                                                         |
| -------- | ------------------------------------------------------------ |
| 终结符   | 1、"字面量"；2、TOKEN                                        |
| 非终结符 | 1、小写字母的预发规则：primary factor expr block simple state program |

### 5.1.4 非终结符详解

- primary 表达式基本构成元素：括号扩起的表达式、标识符（变量名）、整型字面量、字符串字面量。
- factor 因子：一个基元，或一个“-”号加上一个基元
- expr 表达式：两个因子之间夹有一个双目运算符的组合。
- block 语句块：夹在“{”和“}”之间，以“;”或“EOL”分隔的一组语句序列。
- simple 单句：一个表达式构成的语句
- state 语句：if 语句，或while语句，或单句。
- program 程序：一个完整的语句，以“;”或“EOL”结尾。
- OP 语法规则不体现优先级关系，通过其他方式处理优先级。

## 5.2 使用解析器与组合子

实现 5.1 中的语法规则。

1. 通过代码描述语法规则：语法规则 DSL。
2. 使用语法规则分析 Token 序列，生成抽象语法树（5.3节）。

## 5.3 使用语法分析器（Parser）生成抽象语法树（AST）

## 5.4 测试语法分析器（Parser）

## 5.5 总结

AST 核心要点：

- 树形结构 Tree。
- 语法规则 Syntax，和语法元素 Element。
- 语法分析 Parser，将 Token 序列转换成 AST 的算法。

